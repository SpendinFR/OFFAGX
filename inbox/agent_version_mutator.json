{
  "desc_type": "module_emit",
  "name": "agent_version_mutator",
  "code": "import os, json, time, hashlib\\nSRC = 'mem/cortex_history'\\nOUT = 'mem/cortex_candidates'\\n\\ndef _load_last_snapshot():\\n    if not os.path.exists(SRC):\\n        return None\\n    files = sorted([f for f in os.listdir(SRC) if f.endswith('.json')])\\n    if not files:\\n        return None\\n    with open(os.path.join(SRC, files[-1]), 'r', encoding='utf-8') as f:\\n        return json.load(f)\\n\\ndef _mutate_module(m):\\n    src = m.get('src','')\\n    if 'def run(' in src and 'auto_fixed_point' not in src:\\n        src = src.replace('def run(', 'def run_auto_fixed_point(') + \"\\\\n# auto tag\\\\n\"\\n    return {**m, 'src': src}\\n\\ndef run(ctx=None):\\n    snap = _load_last_snapshot()\\n    if not snap:\\n        return {'desc_type':'mutator_idle'}\\n    os.makedirs(OUT, exist_ok=True)\\n    base_mods = snap.get('modules', [])\\n    variants = []\\n    for i in range(3):\\n        ms = []\\n        for m in base_mods:\\n            if m.get('name') == 'cortex_core' or m.get('name','').startswith('generator'):\\n                ms.append(_mutate_module(m))\\n            else:\\n                ms.append(m)\\n        v = {\\n            'desc_type': 'agent_candidate',\\n            'from_snapshot_ts': snap.get('ts'),\\n            'variant_id': f'v_{int(time.time()*1000)}_{i}',\\n            'modules': ms,\\n        }\\n        fname = f'candidate_{int(time.time()*1000)}_{i}.json'\\n        with open(os.path.join(OUT, fname), 'w', encoding='utf-8') as f:\\n            json.dump(v, f, ensure_ascii=False, indent=2)\\n        variants.append({'file': fname})\\n    return {'desc_type':'agent_candidates_emitted','count':len(variants),'ts':time.time()}\\n"
}