{
  "desc_type": "module_emit",
  "name": "implicit_host_reward_learner",
  "code": "import os, json, time, collections, re\\nMEM = 'mem/host_feedback'\\nOUT = 'mem/host_model'\\nWORDS = ['cortex','planner','evaluator','generator','limit','transition','self','patch','math','research']\\n\\ndef _load_corpus(max_files=20):\\n    if not os.path.isdir(MEM): return []\\n    files = sorted([f for f in os.listdir(MEM) if f.startswith('corpus_')])[-max_files:]\\n    rows = []\\n    for fn in files:\\n        with open(os.path.join(MEM, fn), 'r', encoding='utf-8') as f:\\n            for line in f:\\n                line = line.strip()\\n                if not line: continue\\n                try: rows.append(json.loads(line))\\n                except Exception: pass\\n    return rows\\n\\ndef run(ctx=None):\\n    rows = _load_corpus()\\n    if not rows: return {'desc_type':'implicit_host_reward_idle'}\\n    feat_pos = collections.Counter()\\n    feat_neg = collections.Counter()\\n    for r in rows:\\n        ev = r.get('event') or {}\\n        sc = r.get('score', 0)\\n        txt = json.dumps(ev, ensure_ascii=False).lower()\\n        dt = ev.get('desc_type') or ev.get('event') or ''\\n        feats = ['TYPE:'+dt]\\n        for w in WORDS:\\n            if w in txt: feats.append('W:'+w)\\n        for ft in feats:\\n            if sc > 0: feat_pos[ft] += sc\\n            elif sc < 0: feat_neg[ft] += (-sc)\\n    model = {}\\n    for ft in set(list(feat_pos.keys()) + list(feat_neg.keys())):\\n        p = feat_pos[ft]; n = feat_neg[ft]\\n        w = p - n  # poids brut\\n        model[ft] = w\\n    os.makedirs(OUT, exist_ok=True)\\n    path = os.path.join(OUT, 'implicit_host_model.json')\\n    with open(path, 'w', encoding='utf-8') as f: json.dump({'desc_type':'implicit_host_model','ts':time.time(),'weights':model}, f, ensure_ascii=False, indent=2)\\n    return {'desc_type':'implicit_host_model','weights':model}"
}
