{
  "desc_type": "module_emit",
  "name": "self_contract_bootstrap",
  "code": "import os, json, time, hashlib\\nBASE = os.path.join('mem','self_contract')\\nHIST = os.path.join('mem','cortex_history')\\nDEF  = os.path.join(BASE,'contract.json')\\n\\ndef _sha(x):\\n    return hashlib.sha1(json.dumps(x,sort_keys=True,ensure_ascii=False).encode('utf-8')).hexdigest()[:10]\\n\\ndef run(ctx=None):\\n    os.makedirs(BASE, exist_ok=True)\\n    # ce qu on sait quasi toujours dans tes versions\\n    streams = (ctx or {}).get('streams') or []\\n    cortex_files = [s for s in streams if s.startswith('module:') and 'cortex' in s]\\n    contract = {\\n        'desc_type': 'self_contract_v1',\\n        'ts': time.time(),\\n        'identity': 'agx-line',\\n        'cortex': cortex_files,\\n        'must_support': [\\n            'desc_materialisation',\\n            'generator_self_patch',\\n            'module_emit',\\n            'research_task',\\n            'social/affect'\\n        ],\\n        'must_never_drop': [\\n            'auto_exploration',\\n            'auto_satisfy_wants'\\n        ],\\n        'host_is_source': False,\\n        'self_is_source': True,\\n        'schema_v': 1\\n    }\\n    contract['digest'] = _sha(contract)\\n    with open(DEF,'w',encoding='utf-8') as f: json.dump(contract,f,ensure_ascii=False,indent=2)\\n    # on logge l etat pour faire ton fameux diff apres\\n    os.makedirs(HIST, exist_ok=True)\\n    snap = os.path.join(HIST, f\"contract_{int(time.time())}.json\")\\n    with open(snap,'w',encoding='utf-8') as f: json.dump(contract,f,ensure_ascii=False,indent=2)\\n    return {\\n        'desc_type': 'self_contract_built',\\n        'path': DEF,\\n        'digest': contract['digest'],\\n        'ts': time.time()\\n    }"
}
