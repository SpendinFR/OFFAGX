{
  "desc_type": "module_emit",
  "name": "graal_final_form_commit",
  "code": "import os, json, time\\nBASE = os.path.join('mem','graal')\\nBEST = os.path.join(BASE,'best_hypo.json')\\nFINAL = os.path.join(BASE,'final_form.json')\\n\\ndef run(ctx=None):\\n    if not os.path.exists(BEST):\\n        return {'desc_type':'graal_commit_wait_best'}\\n    with open(BEST,'r',encoding='utf-8') as f: best = json.load(f)\\n    # si pas encore de final ou score meilleur â†’ commit\\n    need = False\\n    if not os.path.exists(FINAL):\\n        need = True\\n    else:\\n        with open(FINAL,'r',encoding='utf-8') as f: cur = json.load(f)\\n        if best.get('score',0) > cur.get('score',-1):\\n            need = True\\n    if not need:\\n        return {'desc_type':'graal_commit_nop'}\\n    final = {\\n        'desc_type': 'final_form_commit',\\n        'score': best.get('score',0),\\n        'hypothesis': best.get('hypothesis'),\\n        'ts': time.time()\\n    }\\n    os.makedirs(BASE, exist_ok=True)\\n    with open(FINAL,'w',encoding='utf-8') as f: json.dump(final,f,ensure_ascii=False,indent=2)\\n    return {'desc_type':'final_form_committed','score': final['score']}\\n"
}
