{
  "desc_type": "module_emit",
  "name": "graal_repr_perturb",
  "code": "import os, json, time, hashlib, random\\nBASE = os.path.join('mem','graal')\\nFINAL = os.path.join(BASE,'final_form.json')\\nPERT = os.path.join(BASE,'perturbations.log')\\n\\ndef _dig(x):\\n    return hashlib.sha1(json.dumps(x,sort_keys=True,ensure_ascii=False).encode('utf-8')).hexdigest()[:12]\\n\\ndef _wrap_variant(src, idx):\\n    # 4 styles de perturbations très simples\\n    v = {}\\n    if idx % 4 == 0:\\n        # rename desc_type -> kind\\n        v = {k:src[k] for k in src}\\n        if 'desc_type' in v:\\n            v['kind'] = v.pop('desc_type')\\n    elif idx % 4 == 1:\\n        # tout sous payload\\n        v = {'desc_type': src.get('desc_type','final_form_hypothesis'), 'payload': src}\\n    elif idx % 4 == 2:\\n        # ajout de bruit\\n        v = {k:src[k] for k in src}\\n        v['noise'] = {'ts': time.time(), 'r': random.random()}\\n    else:\\n        # réordonnancement + meta\\n        v = {'meta':'repr_shuffled','hypo':src}\\n    return v\\n\\ndef run(ctx=None):\\n    if not os.path.exists(FINAL):\\n        return {'desc_type':'graal_repr_wait_final'}\\n    with open(FINAL,'r',encoding='utf-8') as f: base = json.load(f)\\n    base_d = _dig(base)\\n    out = []\\n    ts = time.time()\\n    for i in range(5):\\n        var = _wrap_variant(base, i)\\n        var['desc_type'] = 'final_form_hypothesis'\\n        var['origin'] = 'repr_perturb'\\n        var['base_digest'] = base_d\\n        var['ts'] = ts\\n        out.append(var)\\n    os.makedirs(BASE, exist_ok=True)\\n    with open(PERT,'a',encoding='utf-8') as f: f.write(json.dumps({'ts':ts,'n':len(out),'base':base_d},ensure_ascii=False)+'\\\\n')\\n    return out"
}
