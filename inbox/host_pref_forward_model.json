{
  "desc_type": "module_emit",
  "name": "host_pref_forward_model",
  "code": "import os, json, time\\nBASE = 'mem/host_pref'\\nSTATE = os.path.join(BASE, 'state.json')\\nMODEL = os.path.join(BASE, 'forward.json')\\n\\ndef _load_state():\\n    if not os.path.exists(STATE): return None\\n    with open(STATE,'r',encoding='utf-8') as f: return json.load(f)\\n\\ndef _save_model(m):\\n    os.makedirs(BASE, exist_ok=True)\\n    with open(MODEL,'w',encoding='utf-8') as f: json.dump(m,f,ensure_ascii=False,indent=2)\\n\\ndef run(ctx=None):\\n    st = _load_state()\\n    if not st: return {'desc_type':'host_pref_forward_wait_state'}\\n    hist = st.get('history') or []\\n    # petit modèle : pour chaque axis, compter combien de fois il a été choisi\\n    counts = {}\\n    for h in hist:\\n        ax = h.get('axis')\\n        if not ax: continue\\n        counts[ax] = counts.get(ax, 0) + 1\\n    # on en déduit une proba empirique\\n    total = sum(counts.values()) or 1\\n    probs = {ax: c/total for ax, c in counts.items()}\\n    fm = {\\n        'ts': time.time(),\\n        'probs': probs,\\n        'note': 'empirical forward model from host choices'\\n    }\\n    _save_model(fm)\\n    return {'desc_type':'host_pref_forward_updated','probs':probs}"
}
