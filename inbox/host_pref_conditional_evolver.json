{
  "desc_type": "module_emit",
  "name": "host_pref_conditional_evolver",
  "code": "import os, json, time\\nBASE = 'mem/host_pref'\\nSTATE = os.path.join(BASE, 'state.json')\\nMODEL = os.path.join(BASE, 'forward.json')\\n\\ndef _load(p):\\n    if not os.path.exists(p): return None\\n    with open(p,'r',encoding='utf-8') as f: return json.load(f)\\n\\ndef run(ctx=None):\\n    st = _load(STATE)\\n    fm = _load(MODEL)\\n    if not st or not fm:\\n        return {'desc_type':'host_pref_conditional_idle'}\\n    probs = fm.get('probs') or {}\\n    if not probs:\\n        return {'desc_type':'host_pref_conditional_no_probs'}\\n    # on prend l'axe avec proba max \\n    best_axis = max(probs.items(), key=lambda x: x[1])[0]\\n    if best_axis == 'structure_discovery':\\n        return {\\n            'desc_type': 'cortex_evolution_plan',\\n            'target_plane': 'planner',\\n            'injections': [\\n                { 'kind': 'planner_frag', 'code': \"out.append({'desc_type':'schema_hyp','quality':'draft','from':'cond_evolver'})\" }\\n            ],\\n            'test_scenario': 'emit_schema_hyp',\\n            'ts': time.time()\\n        }\\n    if best_axis == 'novelty_gap':\\n        return {\\n            'desc_type': 'generator_self_patch',\\n            'code': \"# patch: penalize already-seen patterns\\\\nimport json, time\\\\nSEEN = set()\\\\ndef generate_module_from_desc(desc):\\\\n    raw = json.dumps(desc, sort_keys=True)\\\\n    if raw in SEEN:\\\\n        return '# already seen, skip'\\\\n    SEEN.add(raw)\\\\n    return '\\\\n'.join(['# novel desc', 'def run(ctx=None):', '    return '+raw])\",\\n            'ts': time.time()\\n        }\\n    if best_axis == 'long_horizon':\\n        return {\\n            'desc_type': 'bridge_spec',\\n            'from_plane': 'research',\\n            'to_plane': 'generator',\\n            'note': 'host wants long horizon',\\n            'ts': time.time()\\n        }\\n    # fallback\\n    return {\\n        'desc_type': 'maintenance_event',\\n        'what': 'cond_evolver_nothing_to_do',\\n        'ts': time.time()\\n    }"
}
