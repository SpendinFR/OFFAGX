{
  "desc_type": "module_emit",
  "name": "skill_requirement_router",
  "code": "import os, json, time, re\nPATTERN_PATH = 'mem/skill_patterns.json'\n\nDEF_PATTERNS = [\n    { 'name': 'web_scrape', 're': r'(web|http|site|url|scrap)', 'deps': ['env:python', 'lib:requests', 'lib:beautifulsoup4'] },\n    { 'name': 'table_data', 're': r'(csv|excel|tableau|spreadsheet)', 'deps': ['env:python', 'lib:pandas'] }\n]\n\ndef _load_patterns():\n    if not os.path.exists(PATTERN_PATH):\n        return DEF_PATTERNS[:]\n    with open(PATTERN_PATH, 'r', encoding='utf-8') as f:\n        saved = json.load(f)\n    return DEF_PATTERNS + saved\n\n\ndef _match_patterns(text: str):\n    pats = _load_patterns()\n    for p in pats:\n        if re.search(p['re'], text, re.IGNORECASE):\n            return p\n    return None\n\n\ndef run(ctx=None):\n    ctx = ctx or {}\n    task = ctx.get('task') or ctx.get('text') or ctx.get('goal') or ''\n    if not task:\n        return {'desc_type': 'skill_req_router_error', 'reason': 'no_task', 'ts': time.time()}\n    m = _match_patterns(task)\n    if m:\n        sid = 'skill_' + str(abs(hash(task)))[:10]\n        return {\n            'desc_type': 'skill_build_plan',\n            'skill_id': sid,\n            'task_text': task,\n            'deps': m.get('deps', ['env:python']),\n            'steps': [\n                {'step': 'ensure_deps', 'deps': m.get('deps', [])},\n                {'step': 'gen_skill', 'skill_id': sid, 'task_text': task},\n                {'step': 'test_skill', 'skill_id': sid}\n            ],\n            'source': 'router',\n            'ts': time.time()\n        }\n    return {\n        'desc_type': 'skill_req_llm_request',\n        'task_text': task,\n        'ts': time.time()\n    }\n"
}
