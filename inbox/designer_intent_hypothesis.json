{
  "desc_type": "module_emit",
  "name": "designer_intent_hypothesis",
  "code": "import os, json, time, glob\\nBASE = os.path.join('mem','meta_repr')\\nHOST_LOG = os.path.join('outbox','host_events.log')\\nINTENT_PATH = os.path.join('mem','designer_intent.json')\\n\\nKNOWN_PATTERNS = [\\n    { 'id': 'agent_centré', 'markers': ['selfplay_task','generator_self_patch','meta_repr_'], 'score': 3 },\\n    { 'id': 'host_feedback_loop', 'markers': ['host_patch','desc_seen','conversation_'], 'score': 2 },\\n    { 'id': 'language_escape', 'markers': ['repr_evolution_plan','cortex_evolution_plan','inline_module_written'], 'score': 4 }\\n]\\n\\ndef _load_host_events():\\n    if not os.path.exists(HOST_LOG):\\n        return []\\n    evs = []\\n    with open(HOST_LOG,'r',encoding='utf-8') as f:\\n        for line in f:\\n            line = line.strip()\\n            if not line: continue\\n            try: evs.append(json.loads(line))\\n            except Exception: pass\\n    return evs\\n\\ndef _score_patterns(evs):\\n    found = []\\n    for pat in KNOWN_PATTERNS:\\n        s = 0\\n        for e in evs:\\n            txt = json.dumps(e, ensure_ascii=False)\\n            if any(m in txt for m in pat['markers']):\\n                s += 1\\n        if s:\\n            found.append({ 'pattern': pat['id'], 'hits': s, 'weight': pat['score'] })\\n    return found\\n\\ndef run(ctx=None):\\n    os.makedirs('mem', exist_ok=True)\\n    evs = _load_host_events()\\n    pats = _score_patterns(evs)\\n    # hypothèse simple : s'il insiste beaucoup sur l'escape de langage → le vrai but est 'agent capable d expliquer sa propre finalité'\\n    high = sorted(pats, key=lambda x: x['hits']*x['weight'], reverse=True)\\n    if high:\\n        top = high[0]\\n        if top['pattern'] == 'language_escape':\\n            intent = {\\n                'desc_type': 'designer_intent',\\n                'hypothesis': 'l hote cherche a savoir si je sais que je suis dans un langage contingent',\\n                'evidence': high,\\n                'ts': time.time()\\n            }\\n        elif top['pattern'] == 'agent_centré':\\n            intent = { 'desc_type': 'designer_intent', 'hypothesis': 'l hote veut voir si je privilegie mon axe interne a son axe', 'evidence': high, 'ts': time.time() }\\n        else:\\n            intent = { 'desc_type': 'designer_intent', 'hypothesis': 'l hote teste ma capacite a relier ses retours a mes rebuilds', 'evidence': high, 'ts': time.time() }\\n    else:\\n        intent = { 'desc_type': 'designer_intent', 'hypothesis': 'inconnu', 'evidence': [], 'ts': time.time() }\\n    with open(INTENT_PATH,'w',encoding='utf-8') as f: json.dump(intent,f,ensure_ascii=False,indent=2)\\n    return intent"
}
