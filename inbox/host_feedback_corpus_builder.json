{
  "desc_type": "module_emit",
  "name": "host_feedback_corpus_builder",
  "code": "import os, json, time, re\\nOUTBOX = 'outbox'\\nMEM = 'mem/host_feedback'\\nGOOD = {'eval','desc_materialized','generator_added','generator_patched','host_meta_learned','host_feedback_emitted','cortex_fixed_point_reached','cortex_diffed','self_feedback_tick','host_pref_inferred','aux_eval','capability_updated','cortex_thresholded','desc_patched','limit_shape_mdl_best','transition_rule_set_written'}\\nBAD = {'module_exec_error','module_run_error','host_patch_error'}\\n\\ndef _scan_outbox():\\n    evs = []\\n    if not os.path.isdir(OUTBOX):\\n        return evs\\n    for fn in os.listdir(OUTBOX):\\n        if not fn.endswith('.log'):\\n            continue\\n        with open(os.path.join(OUTBOX, fn), 'r', encoding='utf-8') as f:\\n            for line in f:\\n                line = line.strip()\\n                if not line:\\n                    continue\\n                try:\\n                    evs.append(json.loads(line))\\n                except Exception:\\n                    continue\\n    return evs\\n\\ndef _score(ev):\\n    dt = ev.get('desc_type')\\n    if dt in GOOD:\\n        return 1\\n    if dt in BAD:\\n        return -1\\n    return 0\\n\\ndef run(ctx=None):\\n    os.makedirs(MEM, exist_ok=True)\\n    evs = _scan_outbox()\\n    if not evs:\\n        return {'desc_type':'host_feedback_corpus_empty'}\\n    ts = int(time.time()*1000)\\n    path = os.path.join(MEM, f'corpus_{ts}.jsonl')\\n    wrote = 0\\n    with open(path, 'w', encoding='utf-8') as f:\\n        for ev in evs:\\n            sc = _score(ev)\\n            if sc == 0:\\n                continue\\n            row = {'ts': ev.get('ts', time.time()), 'event': ev, 'score': sc}\\n            f.write(json.dumps(row, ensure_ascii=False) + '\\\\n')\\n            wrote += 1\\n    return {'desc_type':'host_feedback_corpus_built','file':path,'rows':wrote}\\n"
}