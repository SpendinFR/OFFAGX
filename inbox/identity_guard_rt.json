{
  "desc_type": "orchestrator_frag",
  "name": "identity_guard_rt",
  "code": "# --- identity / envelope guard ---\nIDENTITY = {\n    'agent_id': 'agx-v987',\n    'min_trust': 0.25,\n    'forbidden_actuators': [\n        'os_task:rm',\n        'os_task:reboot',\n        'os_task:shutdown'\n    ],\n    'blocked_desc_types': [\n        'host_patch_destroy',\n        'wipe_memory',\n        'identity_overwrite'\n    ]\n}\n\ndef _want_is_forbidden(w: dict) -> bool:\n    goal = (w.get('goal') or w.get('want') or '').lower()\n    # trucs qu'on laisse toujours passer\n    if goal in ('obtain_missing', 'rewrite_engine'):\n        return False\n    # actuator explicite\n    act = (w.get('actuator') or '').lower()\n    for bad in IDENTITY['forbidden_actuators']:\n        if act.startswith(bad):\n            return True\n    return False\n\n# on filtre les wants AVANT d'en faire des tasks\nfiltered_wants = []\nfor w in wants:\n    if _want_is_forbidden(w):\n        out.append({\n            'desc_type': 'identity_violation',\n            'who': IDENTITY['agent_id'],\n            'want': w,\n            'ts': time.time()\n        })\n    else:\n        filtered_wants.append(w)\n\n# on remplace la liste que verra l'orchestrateur\nwants[:] = filtered_wants"
}
