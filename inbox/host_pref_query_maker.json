{
  "desc_type": "module_emit",
  "name": "host_pref_query_maker",
  "code": "import os, json, time, random\\nBASE = 'mem/host_pref'\\nSTATE = os.path.join(BASE, 'state.json')\\nOUTBOX = 'outbox'\\n\\ndef _load():\\n    if not os.path.exists(STATE): return None\\n    with open(STATE,'r',encoding='utf-8') as f: return json.load(f)\\n\\ndef _save(st):\\n    os.makedirs(BASE, exist_ok=True)\\n    with open(STATE,'w',encoding='utf-8') as f: json.dump(st,f,ensure_ascii=False,indent=2)\\n\\ndef run(ctx=None):\\n    st = _load()\\n    if not st:\\n        return {'desc_type':'host_pref_query_wait_state'}\\n    if st.get('pending_query') is not None:\\n        return {'desc_type':'host_pref_query_already_pending'}\\n    axes = st.get('axes') or []\\n    if len(axes) < 3:\\n        return {'desc_type':'host_pref_query_not_enough_axes'}\\n    opts = random.sample(axes, 3)\\n    q = {\\n        'desc_type': 'host_query',\\n        'question': 'Par quelle direction je me rapproche le plus de ton 4/4 ?',\\n        'options': [\\n            {'id': 0, 'axis': opts[0], 'meaning': 'j augmente mon auto-recoding explicite'},\\n            {'id': 1, 'axis': opts[1], 'meaning': 'je dÃ©couvre des structures/meta-cortex'},\\n            {'id': 2, 'axis': opts[2], 'meaning': 'je pousse vers la recherche/maths'}\\n        ],\\n        'ts': time.time()\\n    }\\n    st['pending_query'] = q\\n    _save(st)\\n    os.makedirs(OUTBOX, exist_ok=True)\\n    with open(os.path.join(OUTBOX, 'host_query_last.json'),'w',encoding='utf-8') as f: json.dump(q,f,ensure_ascii=False,indent=2)\\n    return q"
}
