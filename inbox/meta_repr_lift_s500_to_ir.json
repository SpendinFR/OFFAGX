{
  "desc_type": "module_emit",
  "name": "meta_repr_lift_s500_to_ir",
  "code": "import json, time\\n\\n# AGX_IR1 = { 'kind': 'ir_node', 'tag': <str>, 'fields': {..} }\\n\\ndef s500_to_ir(desc: dict) -> dict:\\n    # on garde le coeur : desc_type, missing, code, ts\\n    ir = {\\n        'kind': 'ir_node',\\n        'tag': 'desc',\\n        'fields': {\\n            'desc_type': desc.get('desc_type'),\\n            'meta': {\\n                'ts': desc.get('ts', time.time()),\\n                'lang_v': desc.get('lang_v', 1),\\n            },\\n            'payload': {}\\n        }\\n    }\\n    # on remonte tout le reste dans payload\\n    for k, v in desc.items():\\n        if k in ('desc_type','ts','lang_v'):\\n            continue\\n        ir['fields']['payload'][k] = v\\n    return ir\\n\\ndef ir_to_s500(ir: dict) -> dict:\\n    if ir.get('kind') != 'ir_node':\\n        return { 'desc_type': 'ir_error', 'reason': 'not_ir' }\\n    f = ir.get('fields') or {}\\n    base = { 'desc_type': f.get('desc_type') or 'ir_desc', 'ts': f.get('meta',{}).get('ts', time.time()), 'lang_v': f.get('meta',{}).get('lang_v', 1) }\\n    payload = f.get('payload') or {}\\n    base.update(payload)\\n    return base\\n\\ndef run(ctx=None):\\n    desc = (ctx or {}).get('desc')\\n    if not desc:\\n        return { 'desc_type': 'meta_repr_lift_idle', 'ts': time.time() }\\n    ir = s500_to_ir(desc)\\n    back = ir_to_s500(ir)\\n    # on donne les deux au runtime\\n    return {\\n        'desc_type': 'meta_repr_lifted',\\n        'original': desc,\\n        'ir': ir,\\n        'roundtrip': back,\\n        'equiv': _eq_shallow(desc, back),\\n        'ts': time.time()\\n    }\\n\\ndef _eq_shallow(a: dict, b: dict) -> bool:\\n    ka = set(a.keys()); kb = set(b.keys())\\n    if ka != kb: return False\\n    for k in ka:\\n        if a[k] != b[k]:\\n            return False\\n    return True"
}
