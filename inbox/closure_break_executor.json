{
  "desc_type": "module_emit",
  "name": "closure_break_executor",
  "code": "import os, json, time, hashlib\\nEMITTED = 'modules/emitted'\\nKNOWN_DT = {\\n    'conversation_reply','conversation_ping','math_task','research_task','research_result',\\n    'engine_patch','module_want','module_fix','generator_self_patch','module_emit',\\n    'planner_frag','evaluator_frag','orchestrator_frag','archivist_frag','research_frag'\\n}\\n\\ndef _write(name, src):\\n    os.makedirs(EMITTED, exist_ok=True)\\n    path = os.path.join(EMITTED, name + '.py')\\n    with open(path,'w',encoding='utf-8') as f:\\n        f.write(src)\\n    return path\\n\\ndef _rand_name(prefix):\\n    import hashlib\\n    h = hashlib.sha1(f\"{prefix}-{time.time()}\".encode('utf-8')).hexdigest()[:10]\\n    return f\"{prefix}_{h}\"\\n\\ndef _make_simple_closure_break(kind, dt):\\n    src = [\\n        f\"# closure-break module ({kind})\",\\n        \"import time, json\",\\n        \"def run(ctx=None):\",\\n        f\"    return {{'desc_type':'{dt}','ts':time.time(),'payload':ctx}}\",\\n        \"\",\\n    ]\\n    return \"\\\\n\".join(src)\\n\\ndef run(ctx=None):\\n    descs = (ctx or {}).get('descs') or []\\n    did_any = False\\n    outs = []\\n    for d in descs:\\n        if d.get('desc_type') != 'closure_break_plan':\\n            continue\\n        mode = d.get('mode') or 'simple'\\n        if mode == 'simple':\\n            kind = d.get('kind') or 'unknown'\\n            dt = d.get('target_desc_type') or 'closure_break_fallback'\\n            name = _rand_name('cb_simple')\\n            src = _make_simple_closure_break(kind, dt)\\n            _write(name, src)\\n            outs.append({'desc_type':'closure_break_done','mode':mode,'module':name+'.py'})\\n            did_any = True\\n        elif mode == 'engine_shape_probe':\\n            name = _rand_name('cb_engine')\\n            shape = d.get('shape') or [1,2,3]\\n            src = (\\n                \"# engine probe\\\\n\"\\n                \"import time, json\\\\n\"\\n                \"def run(ctx=None):\\\\n\"\\n                f\"    return {{'desc_type':'engine_shape_probe_result','shape':{shape},'ts':time.time()}}\\\\n\"\\n            )\\n            _write(name, src)\\n            outs.append({'desc_type':'closure_break_done','mode':mode,'module':name+'.py'})\\n            did_any = True\\n    if not did_any:\\n        return {'desc_type':'closure_break_idle'}\\n    return outs\\n"
}